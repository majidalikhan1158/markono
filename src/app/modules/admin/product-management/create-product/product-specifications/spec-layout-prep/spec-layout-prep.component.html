<div class="row spec-layout-prep" [ngClass]="(store.$productSpecReadonly | async) && !(store.$IsPrepressModule | async) ? 'readonly-box' : '' ">
    <div class="col-lg-12">
        <span class="font-16px font-roboto-bold">Layout Prep</span>
        <mat-hint class="font-14px d-flex">Decide how the product is to be manufactured</mat-hint>
    </div>

    <div class="col-lg-12 pt-2 pb-4">
        <mat-divider></mat-divider>
    </div>

    <div class="col-lg-12">
        <span class="labels font-14px" style="color: #717171">Imposition Inputs</span>
    </div>

    <div class="col-lg-12 pt-6 pb-6">
        <mat-divider></mat-divider>
    </div>

    <div class="col-lg-12 padding-0px">
        <div class="tab-content">
            <!--begin::Table-->
            <div class="">
                <table
                    class="table table-head-custom table-head-bg table-borderless table-vertical-center component-table">
                    <thead>
                        <tr class="text-left text-uppercase">
                            <th *ngFor="let item of columnsToDisplayCompTable"> {{item}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="outer-row" *ngFor="let row of layoutPrepVM?.Components">
                            <td>{{row.ComponentType === componentTypes.None ? '' : row.ComponentType }}</td>
                            <td>
                                <mat-form-field appearance="fill" class="width-100">
                                    <mat-select [(ngModel)]="row.ImpositionLayout">
                                        <mat-option *ngFor="let item of impositionListObjectsKey[row.ComponentType]" [value]="item.layoutName">
                                            {{item.layoutName}}</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </td>
                            <td>
                                <mat-form-field appearance="fill" class="width-100" *ngIf="!(row.ComponentType === componentTypes.Cover || row.ComponentType === componentTypes.Jacket)" >
                                    <mat-select [(ngModel)]="row.GrainDirectionInternal">
                                        <mat-option value="True">True</mat-option>
                                        <mat-option value="False">False</mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </td>
                            <td>
                                <mat-form-field appearance="fill" class="width-100">
                                    <input matInput [(ngModel)]="row.CuttingSizeDepth" type="number" min="0">
                                </mat-form-field>
                            </td>
                            <td>
                                <mat-form-field appearance="fill" class="width-100">
                                    <input matInput [(ngModel)]="row.CuttingSizeWidth" type="number" min="0">
                                </mat-form-field>
                            </td>
                            <td>
                                <mat-form-field appearance="fill">
                                    <mat-select [(ngModel)]="row.Paper">
                                        <ng-container *ngIf="row.Paper">
                                            <mat-option *ngFor="let item of paperListObjectsKey[row.ComponentType]"
                                            [value]="item.paperNo"> {{item.paperNo}} </mat-option>
                                        </ng-container>
                                        <ng-container *ngIf="!row.Paper">
                                            <mat-option *ngFor="let item of paperListObjectsKey[row.ComponentType]"
                                            value=""> {{item.paperNo}} </mat-option>
                                        </ng-container>
                                       
                                    </mat-select>
                                </mat-form-field>
                            </td>
                        </tr>
                        <tr class="outer-row" *ngIf="!(layoutPrepVM?.Components.length > 0) && !shouldShowLoader">
                            <td colspan="6" style="text-align: center;">No records found</td>
                        </tr>
                        <tr class="outer-row" *ngIf="!layoutPrepVM && shouldShowLoader">
                            <td colspan="6">
                                <mat-progress-spinner
                                    style="margin: auto" 
                                  color="primary" 
                                  mode="indeterminate">
                                </mat-progress-spinner>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!--end::Table-->
        </div>
    </div>

    <div class="col-lg-12 pt-3">
        <span class="labels font-14px">Components Breakdown</span>
    </div>

    <div class="col-lg-12 pt-6 pb-6">
        <mat-divider></mat-divider>
    </div>

    <div class="col-lg-12 padding-0px">
        <div class="tab-content">
            <!--begin::Table-->
            <div class="">
                <table
                    class="table table-head-custom table-head-bg table-borderless table-vertical-center component-table table-responsive">
                    <thead>
                        <tr class="text-left text-uppercase">
                            <th *ngFor="let item of columnsToDisplayCompBreakTable"> {{item}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let row of layoutPrepVM?.ComponentsBreakdown; let i = index" >
                            <tr style="cursor: pointer;"
                            [ngClass]="selectedComponentBreakdown === row.Id ? 'outer-row selected-background' : 'outer-row'"
                            (click)="handleComponentBreakdownSelection(row.Id)">
                                <td> {{row.ComponentsSNo}} </td>
                                <td> {{row.ComponentType}} </td>
                                <td> {{row.Layout}} </td>
                                <td> {{row.Quantity}} </td>
                                <td> {{row.PrintingSheets}} </td>
                                <td> {{row.Scrap}} </td>
                                <td> {{row.TotalSheets}} </td>
                                <td> {{row.Colour}} </td>
                                <td style="width: 10%;"> {{row.Paper}} </td>
                                <td> {{row.PaperSize}} </td>
                                <td>
                                    <mat-form-field appearance="fill">
                                        <mat-select [(ngModel)]="row.MachineType">
                                            <mat-option value="4 Color Press">4 Color Press</mat-option>
                                            <mat-option value="5 Color Press">5 Color Press</mat-option>
                                            <mat-option value="8 Color Press">8 Color Press</mat-option>
                                            <mat-option value="Mono Press">Mono Press</mat-option>
                                            <mat-option value="Digital (std)">Digital (std)</mat-option>
                                            <mat-option value="Digital (Enhance)">Digital (Enhance)</mat-option>
                                            <mat-option value="Digital (Premium)">Digital (Premium)</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </td>
                                <td>
                                    <span class="material-icons delete-icon pl-4 pr-2 cursor-pointer"
                                        *ngIf="store.$IsPrepressModule | async">
                                        delete
                                    </span>
                                </td>
                            </tr>
                        </ng-container>
                        <tr class="outer-row" *ngIf="!(layoutPrepVM?.ComponentsBreakdown.length > 0) && !shouldShowLoader">
                            <td colspan="11" style="text-align: center;">No records found</td>
                        </tr>
                        <tr class="outer-row" *ngIf="!layoutPrepVM && shouldShowLoader">
                            <td colspan="11">
                                <mat-progress-spinner
                                    style="margin: auto" 
                                  color="primary" 
                                  mode="indeterminate">
                                </mat-progress-spinner>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!--end::Table-->
        </div>
    </div>

    <a class="pl-3" (click)="openModal('ADD_COMPONENT_BREAKDOWN')" 
        *ngIf="layoutPrepVM && store.$IsPrepressModule | async">
        <span class="material-icons add-icon pr-2 cursor-pointer font-18px ">
            add_circle_outline
        </span>
        <span class="font-12px blue-link ">Add Another</span>
    </a>

    <div class="col-lg-12 pt-6 pb-6">
        <mat-divider></mat-divider>
    </div>

    <div class="col-lg-12 pt-3">
        <span class="labels font-14px">Production Activities</span>
    </div>

    <div class="col-lg-12 pt-6 pb-6">
        <mat-divider></mat-divider>
    </div>

    <div class="col-lg-12 padding-0px">
        <div class="tab-content">
            <!--begin::Table-->
            <div class="">
                <table
                    class="table table-head-custom table-head-bg table-borderless table-vertical-center product-activitiy-table table-responsive">
                    <thead>
                        <tr class="text-left text-uppercase">
                            <th *ngFor="let item of columnsToDisplayProdActivityTable"> {{item}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <ng-container *ngFor="let row of productionActivitiesList;let i = index;">
                            <tr class="outer-row">
                                <td> {{row.ComponentBreakdownSNo}}</td>
                                <td> {{row.Dept}} </td>
                                <td> {{row.Type}} </td>
                                <td> {{row.Qty}} </td>
                                <td> {{row.Layout}} </td>
                                <td>
                                    {{row.ProcessCode}} {{row.Activity}}
                                </td>
                                <td> ${{row.TotalEstCost}} </td>
                                <td> 2.86% </td>
                                <td> {{row.Unit}} </td>
                                <td> {{row.Duration}} </td>
                                <td> ${{row.UnitCost}} </td>
                                <td> ${{row.NewUnitCost}} </td>
                                <td class="action-column pb-0">
                                    <span class="material-icons expansion-icon" (click)="showDetails(i)">
                                        {{
                                        i== rowIdToExpand ?
                                        ExpansionIcons.KEYBOARD_ARROW_UP :
                                        ExpansionIcons.KEYBOARD_ARROW_DOWN
                                        }}
                                    </span>
                                </td>
                            </tr>
                            <ng-container *ngIf="shouldShowDetails && i == rowIdToExpand" class="width-100">
                                <tr>
                                    <td colspan="14" class="pl-0">
                                        <table
                                        class="table table-head-custom table-head-bg table-borderless 
                                        table-vertical-center product-activitiy-child-table mb-0">
                                        <thead>
                                            <tr class="text-left text-uppercase expandedRow padding-11" style="border-bottom: 1px solid #e6e6e6;">
                                                <th class="info-label">In Use</th>
                                                <th class="info-label">Operation Code</th>
                                                <th class="info-label">Operation Description</th>
                                                <th class="info-label"></th>
                                                <th class="info-label">UOM</th>
                                                <th class="info-label">Unit Selling Price</th>
                                                <th class="info-label">Sales Amount</th>
                                                <th class="info-label">Formula Code</th>
                                                <th class="info-label">Speed Table</th>
                                                <th class="info-label"> Price List Code</th>
                                                <th class="info-label"></th>
                                                <th class="info-label"></th>
                                                <th class="info-label"></th>
                                                <th class="info-label"></th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr class="expandedRow" style="border-bottom: 1px solid #afafaf;">
                                                <td class="info-label">
                                                    <span class="material-icons" style="color:green">
                                                        done
                                                    </span>
                                                </td>
                                                <td class="info-label">110</td>
                                                <td class="info-label">-</td>
                                                <td class="info-label">1</td>
                                                <td class="info-label">MAKEREADYPRINT</td>
                                                <td class="info-label">16</td>
                                                <td class="info-label">125.00</td>
                                                <td class="info-label">4202</td>
                                                <td class="info-label">-</td>
                                                <td class="info-label">19212</td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                            </tr>
                                            <tr class="expandedRow" style="border-bottom: 1px solid #afafaf;">
                                                <td class="info-label"></td>
                                                <td class="info-label">110</td>
                                                <td class="info-label">-</td>
                                                <td class="info-label">1</td>
                                                <td class="info-label">MAKEREADYPRINT</td>
                                                <td class="info-label">16</td>
                                                <td class="info-label">125.00</td>
                                                <td class="info-label">4202</td>
                                                <td class="info-label">-</td>
                                                <td class="info-label">19212</td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                            </tr>
                                            <tr class="expandedRow" style="border-bottom: 1px solid #afafaf;">
                                                <td class="info-label"></td>
                                                <td class="info-label">110</td>
                                                <td class="info-label">-</td>
                                                <td class="info-label">360</td>
                                                <td class="info-label">MAKEREADYPRINT</td>
                                                <td class="info-label">16</td>
                                                <td class="info-label">125.00</td>
                                                <td class="info-label">4202</td>
                                                <td class="info-label">-</td>
                                                <td class="info-label">19212</td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                            </tr>
                                            <tr class="expandedRow" style="border-bottom: 1px solid #afafaf;">
                                                <td class="info-label">
                                                    <span class="material-icons" style="color:green">
                                                        done
                                                    </span>
                                                </td>
                                                <td class="info-label">110</td>
                                                <td class="info-label">-</td>
                                                <td class="info-label">1</td>
                                                <td class="info-label">MAKEREADYPRINT</td>
                                                <td class="info-label">16</td>
                                                <td class="info-label">125.00</td>
                                                <td class="info-label">4202</td>
                                                <td class="info-label">-</td>
                                                <td class="info-label">19212</td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                                <td class="info-label"></td>
                                            </tr>
                                        </tbody>
                                        </table>
                                    </td>
                                </tr>
                               
                                <!-- <tr class="expandedRow padding-11" style="border-bottom: 1px solid #e6e6e6;">
                                    <th class="info-label">In Use</th>
                                    <th class="info-label">Operation Code</th>
                                    <th class="info-label">Operation Description</th>
                                    <th class="info-label"></th>
                                    <th class="info-label">UOM</th>
                                    <th class="info-label">Unit Selling Price</th>
                                    <th class="info-label">Sales Amount</th>
                                    <th class="info-label">Formula Code</th>
                                    <th class="info-label">Speed Table</th>
                                    <th class="info-label"> Price List Code</th>
                                    <th class="info-label"></th>
                                    <th class="info-label"></th>
                                    <th class="info-label"></th>
                                    <th class="info-label"></th>
                                </tr>
                                <tr class="expandedRow" style="border-bottom: 1px solid #afafaf;">
                                    <td class="info-label">
                                        <span class="material-icons" style="color:green">
                                            done
                                        </span>
                                    </td>
                                    <td class="info-label">110</td>
                                    <td class="info-label">-</td>
                                    <td class="info-label">1</td>
                                    <td class="info-label">MAKEREADYPRINT</td>
                                    <td class="info-label">16</td>
                                    <td class="info-label">125.00</td>
                                    <td class="info-label">4202</td>
                                    <td class="info-label">-</td>
                                    <td class="info-label">19212</td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                </tr>
                                <tr class="expandedRow" style="border-bottom: 1px solid #afafaf;">
                                    <td class="info-label"></td>
                                    <td class="info-label">110</td>
                                    <td class="info-label">-</td>
                                    <td class="info-label">1</td>
                                    <td class="info-label">MAKEREADYPRINT</td>
                                    <td class="info-label">16</td>
                                    <td class="info-label">125.00</td>
                                    <td class="info-label">4202</td>
                                    <td class="info-label">-</td>
                                    <td class="info-label">19212</td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                </tr>
                                <tr class="expandedRow" style="border-bottom: 1px solid #afafaf;">
                                    <td class="info-label"></td>
                                    <td class="info-label">110</td>
                                    <td class="info-label">-</td>
                                    <td class="info-label">360</td>
                                    <td class="info-label">MAKEREADYPRINT</td>
                                    <td class="info-label">16</td>
                                    <td class="info-label">125.00</td>
                                    <td class="info-label">4202</td>
                                    <td class="info-label">-</td>
                                    <td class="info-label">19212</td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                </tr>
                                <tr class="expandedRow" style="border-bottom: 1px solid #afafaf;">
                                    <td class="info-label">
                                        <span class="material-icons" style="color:green">
                                            done
                                        </span>
                                    </td>
                                    <td class="info-label">110</td>
                                    <td class="info-label">-</td>
                                    <td class="info-label">1</td>
                                    <td class="info-label">MAKEREADYPRINT</td>
                                    <td class="info-label">16</td>
                                    <td class="info-label">125.00</td>
                                    <td class="info-label">4202</td>
                                    <td class="info-label">-</td>
                                    <td class="info-label">19212</td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                    <td class="info-label"></td>
                                </tr> -->
                            </ng-container>
                        </ng-container>
                        <tr class="outer-row" *ngIf="!(productionActivitiesList.length > 0) && !shouldShowLoader">
                            <td colspan="14" style="text-align: center;">No records found</td>
                        </tr>
                        <tr class="outer-row" *ngIf="!layoutPrepVM && shouldShowLoader">
                            <td colspan="14">
                                <mat-progress-spinner
                                    style="margin: auto" 
                                  color="primary" 
                                  mode="indeterminate">
                                </mat-progress-spinner>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <!--end::Table-->
        </div>
    </div>
    <a class="pl-3" (click)="openModal('ADD_PRODUCTION_ACTIVITIES_MODAL')" *ngIf="layoutPrepVM">
        <span class="material-icons add-icon pr-2 cursor-pointer font-18px ">
            add_circle_outline
        </span>
        <span class="font-12px blue-link ">Add Another</span>
    </a>
</div>


<app-modal id="ADD_PRODUCTION_ACTIVITIES_MODAL" size="modal-md" *ngIf="selectedModalToOpen === UimodalIds.ADD_PRODUCTION_ACTIVITIES_MODAL">
    <app-add-production-activity-modal (acceptEvent)="handleAddProductionActivityModalEvent($event)" 
    [componentBreakDownList]="layoutPrepVM?.ComponentsBreakdown">
    </app-add-production-activity-modal>
</app-modal>

<app-modal id="ADD_COMPONENT_BREAKDOWN" size="modal-md" *ngIf="selectedModalToOpen === UimodalIds.ADD_COMPONENT_BREAKDOWN">
    <app-add-component-breakdown (acceptEvent)="handleAddComponentBreakdownEvent($event)"
    [componentList]="layoutPrepVM?.Components">
    </app-add-component-breakdown>
</app-modal>