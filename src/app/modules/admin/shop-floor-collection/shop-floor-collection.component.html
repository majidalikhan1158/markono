<div class="shopFloorCollectionScreen">
  <div class="row">
    <div class="col-lg-3 col-12">
      <div class="card card-custom example example-compact gutter-b machine-status-card">
        <div class="card-header padding-b-20px">
          <div class="card-title">
            <h3 class="card-label">Machine Status</h3>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-12 col-12">
              <mat-form-field class="selectBoxMachineStatus">
                <mat-select [(value)]="selectedStatusAction"  (selectionChange)="handleMachineStatusActionChange($event)">
                  <mat-option value="Choose">Choose</mat-option>
                  <mat-option *ngFor="let item of machineStatusActionVM?.machineStatusActionList" [value]="item.id">
                    {{ item.status }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
          </div>
          <br>
          <div class="row last-row">
            <div class="col-lg-12 col-12 display-flex">
              <div class="col-lg-6 col-12 display-flex-direction-column padding-0px">
                <span class="app-label-grey">Time Lapsed</span>
                <span class="font-roboto-bold font-20px">
                  {{(machineSelectedStatusAction && machineSelectedStatusAction.durationF1) ? machineSelectedStatusAction.durationF1 : '00:00:00'}}
                </span>
              </div>
              <div class="col-lg-6 col-12 padding-0px text-right">
                <button mat-raised-button 
                (click)="openUiModal('VIEW_OPERATORS_MODAL', machineSelectedStatusAction.operators)"
                  color="primary"
                  data-toggle="tooltip" 
                  title="{{(machineSelectedStatusAction && machineSelectedStatusAction.operators.length > 0)? '': 'No operators exist' }}"
                  [disabled]="!(machineSelectedStatusAction?.operators?.length > 0)"
                  class="outline-button btnOperators">Operators</button>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div>
    <div class="col-lg-7 col-12">
      <div class="card card-custom example example-compact gutter-b equipment-timeline-card">
        <div class="card-header">
          <div class="card-title">
            <h3 class="card-label">Equipment Status Timeline</h3>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-12">
              <div id="kt_stats_widget_11_chart" class="card-rounded-bottom">
                <apx-chart [series]="timeLineChartOptions.series" [chart]="timeLineChartOptions.chart"
                  [dataLabels]="timeLineChartOptions.dataLabels" [plotOptions]="timeLineChartOptions.plotOptions"
                  [title]="timeLineChartOptions.title" [xaxis]="timeLineChartOptions.xaxis"></apx-chart>
              </div>
            </div>
          </div>
          <div class="row timeline-chart-label-row">
            <div class="col-sm-12">
              <div class="display-flex margin-l-30px">
                <div class="col-xs-1 color-box" style="background-color : #66ff33;"></div>
                <span class="color-box-label"> In Circle</span>
                <div class="col-xs-1 color-box" style="background-color : #ffff4d;"></div>
                <span class="color-box-label"> No Material</span>
                <div class="col-xs-1 color-box" style="background-color : #ffcc33;"></div>
                <span class="color-box-label"> No Operator</span>
                <div class="col-xs-1 color-box" style="background-color : #ff9933;"></div>
                <span class="color-box-label"> Quality</span>
                <div class="col-xs-1 color-box" style="background-color : #ff33ff;"></div>
                <span class="color-box-label"> Tooling</span>
                <div class="col-xs-1 color-box" style="background-color : #3366ff;"></div>
                <span class="color-box-label"> Planned Downtime</span>
                <div class="col-xs-1 color-box" style="background-color : #ff3366;"></div>
                <span class="color-box-label"> Unknown Downtime</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-2 col-12">
      <div class="card card-custom example example-compact gutter-b oee-card">
        <div class="card-header">
          <div class="card-title">
            <h3 class="card-label">OEE</h3>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-12 col-12">
              <!--The content below is only a placeholder and can be replaced.-->
              <div id="kt_stats_widget_11_chart" class="card-rounded-bottom">
                <apx-chart [series]="oeeChartOptions.series" [chart]="oeeChartOptions.chart"
                  [yaxis]="oeeChartOptions.yaxis" [stroke]="oeeChartOptions.stroke" [fill]="oeeChartOptions.fill"
                  [tooltip]="oeeChartOptions.tooltip" [colors]="oeeChartOptions.colors"
                  [markers]="oeeChartOptions.markers" [plotOptions]="oeeChartOptions.plotOptions"></apx-chart>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="row row2">
    <div class="col-lg-7 col-12">
      <div class="card card-custom example example-compact gutter-b onthe-machine-card">
        <div class="card-header">
          <div class="card-title">
            <h3 class="card-label">On The Machine</h3>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-12 col-12 display-flex" *ngIf="machineCurrentJobVM">
              <div class="col-lg-4 padding-left-right-0px display-flex-direction-column">
                <span class="app-label-grey">Current Job</span>
                <span class="font-20px padding-b-5px font-roboto-bold" style="color: #5FACE2;">{{machineCurrentJobVM.jobNo}}</span>
                <span class="font-weight-bold font-12px color-484848">{{machineCurrentJobVM.jobTitle}}</span>
              </div>
              <div class="col-lg-5 display-flex">
                <div class="col-lg-4 padding-left-right-0px display-flex-direction-column">
                  <span class="app-label-grey">Quantity</span>
                  <span class="app-label-black font-20px">{{machineCurrentJobVM.jobQty}}</span>
                </div>
                <div class="col-lg-8 padding-left-right-0px display-flex-direction-column text-right">
                  <span class="app-label-grey padding-b-5px">Choose Job Status</span>
                  <span>
                    <mat-form-field class="selectBoxJobStatus">
                      <mat-select [(value)]="selectedJobAction" (selectionChange)="handleMachineActionChange($event)">
                        <mat-option value="Choose">Choose</mat-option>
                        <mat-option 
                          *ngFor="let item of machineCurrentJobVM.machineJobActionsList" 
                          [value]="item.actionLink"> {{item.status}}
                      </mat-option>
                      </mat-select>
                    </mat-form-field>
                  </span>
                </div>
              </div>
              <div class="col-lg-3 padding-l-0px padding-r-0px">
                <div class="margin-t-22px text-right">
                  <span style="padding-right: 10px;" (click)="handleJobActionState(machineCurrentJobVM?.jobActionStop, 'stopped')">
                    <img src="./assets/media/custom-icons/stop-icon.png" />
                  </span>
                  <span (click)="handleJobActionState(machineCurrentJobVM?.jobActionPause, 'paused')">
                    <img src="./assets/media/custom-icons/pause-icon.png" />
                  </span>
                </div>
              </div>
            </div>
          </div>
          <br>
          <div class="row">
            <div class="col-lg-12">
              <mat-tab-group>
                <mat-tab label="Data Collection">
                  <div class="row" *ngIf="machineCurrentJobVM">
                    <div class="col-12 display-flex">
                      <div class="col-lg-4 data-collection-box" *ngFor="let item of machineCurrentJobVM.machineSummaryList">
                        <div class="row">
                          <div class="col-lg-12">
                            <span class="heading">{{item.statusGrp}}</span>
                          </div>
                        </div>
                        <br>
                        <div class="row">
                          <div class="col-lg-6 display-grid padding-r-0px">
                            <span class="heading-title-value">{{item.durantionInMinutes}} mins</span>
                            <span class="heading-title-label">Time/时间/</span>
                          </div>
                          <div class="col-lg-6 display-grid padding-r-0px">
                            <span class="heading-title-value">{{item.count}}</span>
                            <span class="heading-title-label">Qty/数量/</span>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </mat-tab>
                <mat-tab label="Job Sheet">Content 2</mat-tab>
                <mat-tab label="Product Specs">Content 2</mat-tab>
                <mat-tab label="Customer">Content 2</mat-tab>
              </mat-tab-group>
            </div>
          </div>
          <br>
          <br>
          <br>
          <div class="row" style="padding-bottom: 25px;">
            <div class="col-lg-8">
              <div class="col-lg-12 display-flex padding-0px">
                <span class="font-14px font-roboto-bold">Units Produced (Every Minute)</span>
              </div>
              <div class="col-lg-12 padding-0px" *ngIf="machineCurrentJobUnitsVM && unitsProducedChartOptions">
                <div id="kt_stats_widget_11_chart" class="card-rounded-bottom units-produced-chart">
                  <apx-chart [series]="unitsProducedChartOptions.series"
                    [chart]="unitsProducedChartOptions.chart"
                    [dataLabels]="unitsProducedChartOptions.dataLabels"
                    [plotOptions]="unitsProducedChartOptions.plotOptions"
                    [yaxis]="unitsProducedChartOptions.yaxis" [legend]="unitsProducedChartOptions.legend"
                    [fill]="unitsProducedChartOptions.fill" [stroke]="unitsProducedChartOptions.stroke"
                    [tooltip]="unitsProducedChartOptions.tooltip" [xaxis]="unitsProducedChartOptions.xaxis">
                  </apx-chart>
                </div>
              </div>
            </div>
            <div class="col-lg-4 padding-0px">
              <div class="col-lg-12 display-flex padding-0px">
                <span class="font-14px font-roboto-bold">Cumulative Output</span>
                <span class="font-12px font-roboto-bold" style="float:right; margin: auto">20,320</span>
              </div>
              <div class="col-lg-12 padding-0px">
                <div id="kt_stats_widget_11_chart" class="card-rounded-bottom comulative-chart">
                  <apx-chart [series]="chartOptions.series" [chart]="chartOptions.chart"
                    [xaxis]="chartOptions.xaxis" [yaxis]="chartOptions.yaxis"
                    [dataLabels]="chartOptions.dataLabels" [stroke]="chartOptions.stroke"
                    [legend]="chartOptions.legend" [fill]="chartOptions.fill" [states]="chartOptions.states"
                    [tooltip]="chartOptions.tooltip" [colors]="chartOptions.colors"
                    [markers]="chartOptions.markers" [plotOptions]="chartOptions.plotOptions">
                  </apx-chart>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-lg-5 col-12">
      <div class="card card-custom example example-compact gutter-b jobs-schedule-card">
        <div class="card-header">
          <div class="card-title">
            <div *ngIf="!toggleSearch">
              <h3 class="card-label">Jobs Schedule</h3>
            </div>

            <!-- <div>
              <mat-toolbar-row style="justify-content: space-between;">
                <button mat-icon-button *ngIf="!toggleSearch" (click)="openSearch()">
                  <mat-icon>search</mat-icon>
                </button>
              </mat-toolbar-row>
            </div> -->
            <mat-toolbar class="search-block" [class.active]="toggleSearch">
              <mat-toolbar-row>
                <button class="search-icon" mat-icon-button>
                  <mat-icon>search</mat-icon>
                </button>
                <input class="search-control" type="text" placeholder="Search" [(ngModel)]="searchText">
                <button mat-button mat-icon-button (click)="searchClose()">
                  <mat-icon>close</mat-icon>
                </button>
              </mat-toolbar-row>
            </mat-toolbar>
            <mat-form-field class="selectBoxJobSchedule">
              <mat-select [(value)]="selectedMachineCode" (selectionChange)="handleMachineChange($event)">
                <mat-option 
                  *ngFor="let item of machineVMList"
                  [value]="item.machineCode"
                  >
                  {{item.machineName}}
              </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-lg-12">
              <mat-form-field appearance="outline" class="txtSearchWithJobNo">
                <mat-label>Search with Job No.</mat-label>
                <mat-icon matPrefix>search</mat-icon>
                <input matInput placeholder="Search with Job No.">
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="tab-content" style="width: 100%;">
              <!--begin::Table-->
              <div class="table-responsive scrollableDiv" style="height:467px !important">
                <table class="table table-head-custom table-head-bg table-borderless table-vertical-center
                job-schedule-table">
                  <thead>
                    <tr class="text-left text-uppercase">
                      <th style="min-width: auto;">Scheduled <br>(预定时间)</th>
                      <th style="min-width: auto;">Job No. <br>(编号)</th>
                      <th style="min-width: 82px;">Est. Dur. <br>(预计时间)</th>
                      <th style="min-width: auto;"></th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- <tr *ngIf="shouldShowScheduleLoader">
                      <td colspan="4" class="text-center">
                        <mat-spinner style="margin:auto !important"  diameter="50" [strokeWidth]="10"></mat-spinner>
                      </td>
                    </tr> -->
                    <tr *ngFor="let item of machineScheduleJobsVMList; let i=index">
                      <td>
                        <span class="text-dark-75 font-weight-bolder d-block font-14px padding-left-10px">
                          {{item.scheduledTime | date:'hh:mm'}}
                        </span>
                        <span class="font-weight-bold font-12px padding-left-10px color-484848">
                          {{item.scheduledDate | date:'M/d'}}
                        </span>
                      </td>
                      <td class="row-second-column">
                        <span class="text-dark-75 font-weight-bolder d-block font-14px">
                          {{item.jobNo}}
                        </span>
                        <span class="font-weight-bold font-12px color-484848">
                          {{item.jobTitle}}
                        </span>
                      </td>
                      <td>
                        <span class="text-dark-75 font-weight-bolder d-block font-14px padding-left-15px">
                          {{item.estimatedDuration}}
                        </span>
                        <span class="font-weight-bold font-12px padding-left-15px color-484848">
                          mins
                        </span>
                      </td>
                      <td class="action-column">
                        <button mat-raised-button color="primary" (click)="setScheduleJob(item.links.setJob, i)"
                          class="outline-button btnJobScheduleSelect">
                          Select
                          <!-- <mat-icon *ngIf="clickedScheduleJobButtonId === i"><mat-spinner diameter="10"></mat-spinner></mat-icon> -->
                        </button>
                      </td>
                    </tr>
                    <!-- <tr *ngIf="machineScheduleJobsVMList.length == 0 && !shouldShowScheduleLoader">
                      <td colspan="4" class="text-center">
                        No jobs found.
                      </td>
                    </tr> -->
                    <!-- table-last-row -->
                  </tbody>
                </table>

              </div>
              <!--end::Table-->
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


<app-modal id="VIEW_OPERATORS_MODAL" size="modal-sm">
  <app-view-operators-modal>
  </app-view-operators-modal>
</app-modal>